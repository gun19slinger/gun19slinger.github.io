function Widget(t){this.container=t.container,this.regions=t.regions,this.ambit=this.getAmbit(),this.showAllRegions(),this.dragRegion=null,this.shiftX=null,this.shiftY=null,this.newRegion=null,this.startPointX=null,this.startPointY=null,this.container.addEventListener("mousedown",this.contOnMouseDown.bind(this)),document.addEventListener("mousemove",this.documentOnMouseMove.bind(this)),document.addEventListener("mouseup",this.documentOnMouseUp.bind(this)),this.container.addEventListener("dragstart",function(t){t.preventDefault()})}Widget.prototype.contOnMouseDown=function(t){t.preventDefault(),t.target.classList.contains("region")?this.startDrag(t):"IMG"===t.target.tagName&&this.createNewRegion(t)},Widget.prototype.documentOnMouseMove=function(t){this.dragRegion?this.moveDrag(t):this.newRegion&&this.resizeNewRegion(t)},Widget.prototype.documentOnMouseUp=function(){this.dragRegion?this.stopDrag():this.newRegion&&this.stopResize()},Widget.prototype.createNewRegion=function(t){this.newRegion=document.createElement("div"),this.newRegion.classList.add("region"),this.container.appendChild(this.newRegion),this.startPointX=t.clientX-this.ambit.left,this.startPointY=t.clientY-this.ambit.top},Widget.prototype.resizeNewRegion=function(t){var i,e,n,o,s=t.clientX-this.ambit.left,h=t.clientY-this.ambit.top;s=(s=s<0?0:s)>this.container.clientWidth?this.container.clientWidth:s,h=(h=h<0?0:h)>this.container.clientHeight?this.container.clientHeight:h,this.startPointX>s?(i=s,n=this.startPointX-s):this.startPointX<s&&(i=this.startPointX,n=s-this.startPointX),this.startPointY>h?(e=h,o=this.startPointY-h):this.startPointY<h&&(e=this.startPointY,o=h-this.startPointY),this.newRegion.style.left=i+"px",this.newRegion.style.top=e+"px",this.newRegion.style.width=n+"px",this.newRegion.style.height=o+"px"},Widget.prototype.stopResize=function(){var t=getComputedStyle(this.newRegion),i=parseInt(t.width),e=parseInt(t.height);i<3||e<3?this.container.removeChild(this.newRegion):(this.newRegion.innerHTML=this.randID(),this.regions.push(this.newRegion)),this.newRegion=null,this.startPointX=null,this.startPointY=null},Widget.prototype.startDrag=function(t){this.dragRegion=t.target;var i=this.dragRegion.getBoundingClientRect();this.shiftX=t.clientX-i.left,this.shiftY=t.clientY-i.top},Widget.prototype.moveDrag=function(t){var i=t.clientX-this.shiftX-this.ambit.left,e=t.clientY-this.shiftY-this.ambit.top,n=this.container.clientWidth-this.dragRegion.offsetWidth,o=this.container.clientHeight-this.dragRegion.offsetHeight;i=(i=i<0?0:i)>n?n:i,e=(e=e<0?0:e)>o?o:e,this.dragRegion.style.left=i+"px",this.dragRegion.style.top=e+"px"},Widget.prototype.stopDrag=function(){this.dragRegion=null,this.shiftX=null,this.shiftY=null},Widget.prototype.showRegion=function(t){var i=document.createElement("div");i.classList.add("region"),t.left=t.left<0?0:t.left,t.top=t.top<0?0:t.top,t.width=t.width<5?5:t.width,t.height=t.height<5?5:t.height,i.style.left=t.left+"px",i.style.top=t.top+"px",i.style.width=t.width+"px",i.style.height=t.height+"px",i.innerHTML=t.id,this.container.appendChild(i);var e=this.checkProportions(i);0!==Object.keys(e).length&&(e.ban?this.container.removeChild(i):e.width?i.style.width=e.width+"px":e.height&&(i.style.height=e.height+"px"))},Widget.prototype.showAllRegions=function(){this.regions.forEach(function(t){this.showRegion(t)}.bind(this))},Widget.prototype.getAmbit=function(){var t=getComputedStyle(this.container),i={top:parseInt(t.borderTopWidth),bottom:parseInt(t.borderBottomWidth),left:parseInt(t.borderLeftWidth),right:parseInt(t.borderRightWidth)},e=this.container.getBoundingClientRect();return{left:e.left+i.left,right:e.right-i.right,top:e.top+i.top,bottom:e.bottom-i.bottom}},Widget.prototype.checkProportions=function(t){var i,e=t.getBoundingClientRect(),n={};return e.right>this.ambit.right&&((i=this.ambit.right-e.left)<5?n.ban=!0:n.width=i),e.bottom>this.ambit.bottom&&((i=this.ambit.bottom-e.top)<5?n.ban=!0:n.height=i),n},Widget.prototype.randID=function(){return Math.random().toString(36).slice(8).slice(0,4)};